(()=>{var e={};!function(n){"use strict";e={stripe:null,paymentFormsList:{},finalData:{},zeroDecimals:{},globalStyle:{},init:function(a){this.globalStyle={base:{color:"#32325d",lineHeight:"18px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},a&&(this.globalStyle=a),this.paymentFormsList=n(".enupal-stripe-form-elements"),this.zeroDecimals=["MGA","BIF","CLP","PYG","DJF","RWF","GNF","UGX","JPY","VND","VUV","XAF","KMF","KRW","XOF","XPF"],this.paymentFormsList.each((function(){var a=n(this);e.initializeForm(a),n(this).keydown((function(e){if(13===e.keyCode)return e.preventDefault(),!1}))}))},initializeForm:function(e){if(void 0===n(e).find('[name="enupalStripe[stripeData]"]').val())return!1;var a=n.parseJSON(n(e).find('[name="enupalStripe[stripeData]"]').val()),t=this;navigator.userAgent.indexOf("Firefox")<0&&n(e).find('[name="enupalStripe[stripeData]"]').val(""),this.finalData.finalAmount=a.stripe.amount;var i=Stripe(a.pbk),r=i.elements({locale:a.stripe.locale}),o=n(e).find('[name="paymentType"]'),s=a.paymentTypeIds;if(s.length>1){var l=e.find(".cc-wrapper"),d=e.find(".ideal-wrapper"),u=e.find(".sofort-wrapper");n("#paymentMethod-"+a.paymentFormId).change((function(){var e=this.value;1==e?(o.val(e),l.removeClass("enupal-hidden"),d.addClass("enupal-hidden"),u.addClass("enupal-hidden")):2==e?(d.removeClass("enupal-hidden"),l.addClass("enupal-hidden"),u.addClass("enupal-hidden"),o.val(e)):3==e&&(u.removeClass("enupal-hidden"),d.addClass("enupal-hidden"),l.addClass("enupal-hidden"),o.val(e))}))}if(a.enableShippingAddress&&a.enableBillingAddress){var p=e.find(".shippingAddressContainer");n("#enupalStripe-sameAddressToggle-"+a.paymentFormId).change((function(){this.checked?p.addClass("enupal-hidden"):p.removeClass("enupal-hidden")}))}if(a.coupon.enabled){var m=n("#check-coupon-button-"+a.paymentFormId);this.updateTotalAmoutLabel(e,a);var c=e.find("#remove-coupon-"+a.paymentFormId);this.updatesTotalLabelOnChoosesPlan(e,a),c.click((function(n){n.preventDefault(),t.handleRemoveCoupon(e,a,t)})),m.click((function(n){n.preventDefault(),t.handleCouponValidation(e,a,t)}))}for(var f=0,v=s.length;f<v;f++)1==s[f]?(0==f&&(e.find(".cc-wrapper").removeClass("enupal-hidden"),o.val(s[f])),this.createCardElement(i,a,r,e)):2==s[f]?(0==f&&(e.find(".ideal-wrapper").removeClass("enupal-hidden"),o.val(s[f])),this.createIdealElement(i,a,e,r)):3==s[f]&&(0==f&&(e.find(".ideal-wrapper").removeClass("enupal-hidden"),e.find(".cc-wrapper").removeClass("enupal-hidden"),o.val(s[f])),this.createSofortElement(i,a,e,r))},updateTotalAmoutLabel:function(e,n){var a=e.find("#total-amount-value-"+n.paymentFormId),t=this.getFinalAmount(e,n);a&&a.text(t)},handleRemoveCoupon:function(e,n,a){var t=e.find("#coupon-message-"+n.paymentFormId),i=e.find("#remove-coupon-"+n.paymentFormId),r=e.find("#couponCode-"+n.paymentFormId);r&&r.val(""),t&&t.text(""),i.addClass("enupal-hidden"),e.find('[name="enupalCouponCode"]').val(""),a.updateTotalAmoutLabel(e,n)},handleCouponValidation:function(e,a,t){var i=e.find("#check-coupon-button-"+a.paymentFormId),r=e.find("#coupon-message-"+a.paymentFormId),o=e.find("#remove-coupon-"+a.paymentFormId),s=e.find("#total-amount-value-"+a.paymentFormId),l=e.find("#couponCode-"+a.paymentFormId),d=l.val(),u=a.stripe;l.val("");var p=this.convertToCents(t.getFinalAmount(e,a),u.currency);i.prop("disabled",!0);var m={action:"enupal-stripe/coupons/validate",amount:p,couponCode:d,isRecurring:this.getIsRecurring(e,a),currency:u.currency,successMessage:a.coupon.successMessage};n.ajax({type:"POST",url:"enupal/validate-coupon",data:m,dataType:"json",success:function(n){!0===n.success?(r.removeClass("coupon-error"),r.text(n.successMessage),o.removeClass("enupal-hidden"),s&&s.text(n.finalAmount),e.find('[name="enupalCouponCode"]').val(n.coupon.id)):(r.addClass("coupon-error"),o.addClass("enupal-hidden"),r.text(a.coupon.errorMessage)),i.prop("disabled",!1)}.bind(this),error:function(e,n,a){i.prop("disabled",!1),console.error(e,n,a.toString())}.bind(this)})},createCardElement:function(e,a,t,i){var r="stripe-payments-submit-button-"+a.paymentFormId,o=t.create("card",{hidePostalCode:!0,style:this.globalStyle});o.mount("#card-element-"+a.paymentFormId),o.addEventListener("change",(function(e){var n=document.getElementById("card-errors-"+a.paymentFormId);e.error?n.textContent=e.error.message:n.textContent=""}));i[0];var s=this;i.find("#"+r).on("click",(function(t){if(1!=n(i).find('[name="paymentType"]').val())return!0;var l=i[0];a.enableBillingAddress&&a.enableBillingAddress&&("on"==n(i).find('[name="enupalStripe[sameAddressToggle]"]').val()&&(n(i).find('[name="address[name]"]').removeAttr("required"),n(i).find('[name="address[line1]"]').removeAttr("required"),n(i).find('[name="address[city]"]').removeAttr("required"),n(i).find('[name="address[state]"]').removeAttr("required"),n(i).find('[name="address[zip]"]').removeAttr("required"),n(i).find('[name="address[country]"]').removeAttr("required")));if(l.checkValidity()){t.preventDefault();var d={};s.showProcessingText(i,a),a.enableBillingAddress&&(d={name:n(i).find('[name="billingAddress[name]"]').val(),address_line1:n(i).find('[name="billingAddress[line1]"]').val(),address_city:n(i).find('[name="billingAddress[city]"]').val(),address_state:n(i).find('[name="billingAddress[state]"]').val(),address_zip:n(i).find('[name="billingAddress[zip]"]').val(),address_country:n(i).find('[name="billingAddress[country]"]').val()}),e.createToken(o,d).then((function(e){e.error?document.getElementById("card-errors-"+a.paymentFormId).textContent=e.error.message:s.submitForm(a,i,r,e.token)}))}else{/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&n("#"+l.id+' :input:visible[required="required"]').each((function(){if(!this.validity.valid)return n(this).focus(),n(this).attr("placeholder",this.validationMessage).addClass("placeholderError"),n(this).val(""),!1})),l.reportValidity&&l.reportValidity()}}))},showProcessingText:function(e,n){var a="stripe-payments-submit-button-"+n.paymentFormId;e.find("#"+a).prop("disabled",!0),e.find("#"+a).find("span").length?e.find("#"+a).find("span").text(n.paymentButtonProcessingText):e.find("#"+a).text(n.paymentButtonProcessingText)},submitForm:function(e,a,t,i){var r=n.extend(!0,{},e),o=r.stripe;o.amount=this.convertToCents(this.getFinalAmount(a,r),o.currency),a.find('[name="enupalStripe[amount]"]').val(o.amount),a.find('[name="enupalStripe[testMode]"]').val(r.testMode),i&&a.find('[name="enupalStripe[token]"]').val(i.id),a.unbind("submit",[a,e]),a.submit()},createIdealElement:function(e,a,t,i){var r=this,o=t[0],s="stripe-payments-submit-button-"+a.paymentFormId,l=i.create("idealBank",{style:this.globalStyle});l.mount("#ideal-bank-element-"+a.paymentFormId),l.on("change",(function(e){var n=e.value;t.find('[name="idealBank"]').val(n)})),o.addEventListener("submit",(function(e){if(2!=n(t).find('[name="paymentType"]').val())return!0;e.preventDefault(),r.showProcessingText(t,a),r.submitForm(a,t,s,null)}))},createSofortElement:function(e,a,t,i){var r=this,o=t[0],s="stripe-payments-submit-button-"+a.paymentFormId;o.addEventListener("submit",(function(e){if(3!=n(t).find('[name="paymentType"]').val())return!0;e.preventDefault(),r.showProcessingText(t,a),r.submitForm(a,t,s,null)}))},getIsRecurring:function(e,n){var a=!1;return 1==n.amountType&&(a=e.find('[name="enupalStripe[recurringToggle]"]').is(":checked")),n.enableSubscriptions&&(a=!0),a},getFinalAmount:function(e,n){var a=n.stripe.amount,t=0,i=!1;if(n.enableSubscriptions){var r=null;if(0==n.subscriptionType)n.singleSetupFee>0&&(t=n.singleSetupFee),n.enableCustomPlanAmount&&"undefined"!==(r=e.find('[name="enupalStripe[customPlanAmount]"]').val())&&r>0&&(a=r);else{var o=null;if(r=null,(o="radio"==n.subscriptionStyle?e.find('input[name="enupalStripe[enupalMultiPlan]"]:checked').val():e.find('[name="enupalStripe[enupalMultiPlan]"]').val())in n.multiplePlansAmounts&&(r=n.multiplePlansAmounts[o].amount,n.stripe.currency=n.multiplePlansAmounts[o].currency),o in n.setupFees){var s=n.setupFees[o];s>0&&(t=s)}"undefined"!==r&&r>0&&(a=r)}}else if(1==n.amountType){var l=e.find('[name="enupalStripe[customAmount]"]').val();i=e.find('[name="enupalStripe[recurringToggle]"]').is(":checked"),"undefined"!==l&&l>0&&(a=l)}if((n.applyTax||i)&&n.enableTaxes){var d=parseFloat(n.tax/100*(parseFloat(a)+parseFloat(t))).toFixed(2);a=parseFloat(a)+parseFloat(d);var u=n.taxLabel+": "+n.currencySymbol+d;e.find('[name="enupalStripe[taxAmount]"]').val(d),e.find('[name="tax-amount-label"]').empty().append(u)}return parseFloat(a)+parseFloat(t)},updatesTotalLabelOnChoosesPlan:function(e,a){var t=this;if(0!==a.subscriptionType)if("radio"==a.subscriptionStyle){var i=e.find('input[name="enupalStripe[enupalMultiPlan]"]');n(i).change((function(){n(this).is(":checked")&&t.handleRemoveCoupon(e,a,t)}))}else{var r=e.find('[name="enupalStripe[enupalMultiPlan]"]');n(r).on("change",(function(){t.handleRemoveCoupon(e,a,t)}))}},convertToCents:function(e,n){return this.hasZeroDecimals(n)?e:(100*e).toFixed(0)},convertFromCents:function(e,n){return this.hasZeroDecimals(n)?e:e/100},hasZeroDecimals:function(e){for(var n=0;n<this.zeroDecimals.length;n++)if(this.zeroDecimals[n]===e.toUpperCase())return!0;return!1}},n(document).ready((function(n){var a=null;"undefined"!=typeof enupalStyleOverrides&&(a=enupalStyleOverrides),e.init(a)}))}(jQuery)})();