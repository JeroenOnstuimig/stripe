{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = "products" %}
{% set fullPageForm = true %}
{% set title = "Product: "~stripeObject.name %}

{% set testMode = craft.enupalStripe.getMode() %}
{% set stripeUrl = "https://dashboard.stripe.com" %}
{% set stripeUrl = testMode ? stripeUrl~'/test' : stripeUrl %}

{% set crumbs = [
    {    label: "Product"|t('enupal-stripe'), url: url('enupal-stripe/products') }
] %}

{% hook "cp.enupal-stripe.product.edit" %}

{% set tabs = {
    general:  {
        label: "General"|t,
        url: '#tab1',
    }
} %}

{% block actionButton %}
    <a id="share-btn" href="{{ stripeUrl }}/products/{{ stripeObject.id }}" class="btn sharebtn" target="_blank">Edit Product</a>
{% endblock %}

{% block details %}
    {% namespace 'fields' %}

        {% include 'enupal-stripe/products/_productInfo' %}

    {% endnamespace %}
{% endblock %}

{% block content %}
    {% if not stripeObject.livemode %}
        <span class="testMode">Test Mode</span>
    {% endif %}
    {{ forms.textField({
        label: "Name"|t('enupal-stripe'),
        id: 'name',
        name: 'name',
        readonly: true,
        value: stripeObject.name
    }) }}

    {% if stripeObject.description %}
        {{ forms.field({
            label: 'Description'|t('enupal-stripe'),
            id: 'description'
        }, forms.textArea({
            label: "Description"|t('enupal-stripe'),
            id: 'description',
            readonly: true,
            value: stripeObject.description
        })) }}

    {% endif %}

    {% if stripeObject.images|length > 0 %}
        <div class="field">

            <div class="heading">
                <label for="image-1">Images</label>
            </div>
            <div class="elements">
                <div data-image-width="564" data-image-height="185" data-own-file="" data-movable="" data-replaceable="" class="element hasthumb large removable sel" data-type="craft\elements\Asset"  data-status="enabled" data-editable="" style="visibility: visible;" tabindex="0">
                  <div class="elementthumb checkered">
                        <img id="image-1" sizes="100px" srcset="{{ stripeObject.images[0] }}">
                    </div>
                    <div class="label">
                        <span class="title">Image 1</span>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    {% if prices %}
        {{ forms.field({
            label: 'Prices'|t('enupal-stripe'),
            id: 'prices'
        }) }}
        <div id="variants" class="matrix variant-matrix" style="position: relative;">
            <div class="blocks">
                {% for price in prices %}
                    {% set priceObject = price.getStripeObject() %}
                    <div class="price-matrixblock matrixblock single-col" data-id="{{ price.id }}" tabindex="0">
                        <input class="default-input" type="hidden" name="prices[{{ price.id }}][isDefault]" value="{{ loop.first }}">
                        <div class="titlebar">
                            <div class="preview"></div>
                        </div>
                        <div class="actions">
                            <a id="share-btn" href="{{ stripeUrl ~ '/prices/' ~ priceObject.id }}" class="sharebtn price-edit" target="_blank">Edit Price</a>
                        </div>
                        <div class="fields">
                            <div class="status-properties meta">
                                <div id="prices-{{ price.id }}-status-field" class="field">
                                    <div class="heading">
                                        <label id="prices-{{ price.id }}-status-label" for="prices-{{ price.id }}-status">
                                            Status
                                        </label>
                                    </div>
                                    <div class="input ltr">
                                        {{ price.getStatusHtml|raw }}
                                    </div>
                                </div>
                            </div>

                            <div class="id-properties meta">
                                <div id="prices-{{ price.id }}-id-field" class="field">
                                    <div class="heading">
                                        <label id="prices-{{ price.id }}-id-label" for="prices-{{ price.id }}-id">
                                            Stripe ID
                                        </label>
                                    </div>
                                    <div class="input ltr">
                                        <input readonly autocomplete="off" type="text" id="prices-{{ price.id }}-id" class="code text fullwidth" value="{{ priceObject.id }}" name="prices[{{ price.id }}][id]" autocomplete="off" dir="ltr">
                                    </div>
                                </div>
                            </div>

                            <div class="price-properties meta">
                                <div id="prices-{{ price.id }}-price-field" class="field">
                                    <div class="heading">
                                        <label id="prices-{{ price.id }}-price-label" for="prices-{{ price.id }}-price">
                                            Price ({{ priceObject.currency|upper }})
                                        </label>
                                    </div>
                                    <div class="input ltr">
                                        <input readonly autocomplete="off" type="text" id="prices-{{ price.id }}-price" class="code text fullwidth" value="{{ craft.enupalStripe.convertFromCents(priceObject.unit_amount, priceObject.currency ) }}" name="prices[{{ price.id }}][price]" autocomplete="off" dir="ltr">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}

            </div>
        </div>
    {% endif %}
{% endblock %}

{% css %}
    .testMode {
    background-color: #f7e633;
    color: #363636;
    border-radius: 5px;
    font-weight: 700;
    font-size: 11px;
    text-transform: uppercase;
    padding-left: 9px;
    padding-right: 9px;
    height: 26px;
    line-height: 26px;
    }

    @charset "UTF-8";

    .lazy-create-modal {
    min-width: 200px;
    overflow: auto;
    }

    /* Variant Matrix styles */
    .price-matrixblock {
    padding: 0;
    }

    .price-matrixblock > .titlebar {
    margin: 0;
    width: 100%;
    }

    .price-matrixblock > .fields {
    padding-top: 0 !important;
    }

    .price-matrixblock .text {
    background: transparent;
    }

    body.ltr .price-matrixblock > .titlebar {
    padding-right: 140px;
    }

    body.rtl .price-matrixblock > .titlebar {
    padding-left: 140px;
    }

    .price-matrixblock > .actions > .default-btn {
    display: inline-block;
    margin: -1px 7px;
    border-radius: 3px;
    padding: 0 4px !important;
    width: auto !important;
    height: auto !important;
    font-size: 11px;
    text-transform: uppercase;
    color: hsl(212, 10%, 75%);
    text-decoration: none !important;
    font-weight: bold;
    border: 1px solid rgba(0, 0, 0, 0.25);
    }

    .price-matrixblock > .actions > .default-btn:not(.sel):hover {
    border-color: hsl(212, 90%, 50%);
    }

    .price-matrixblock > .actions > .default-btn.sel {
    color: #eef0f1;
    background: rgba(0, 0, 0, 0.25);
    background-clip: padding-box;
    }

    .price-matrixblock:not(.single-col) > .fields {
    display: flex;
    align-items: stretch;
    }

    .price-matrixblock:not(.single-col) > .fields > .price-properties {
    width: 310px;
    border-right: 1px solid #e3e5e8;
    }

    .price-properties > .price-properties-dimensions > .input > .flex > .textwrapper > .text {
    margin: 0;
    padding: 7px 0;
    }

    .price-matrixblock:not(.single-col) > .fields > .custom-fields {
    padding: 14px 24px;
    width: calc(100% - 359px);
    }

    .price-matrixblock.single-col > .fields > .custom-fields {
    border-top: 1px solid #e3e5e8;
    }
    .price-edit{
        color: #596673 !important;
    }
{% endcss %}

{% do view.registerAssetBundle("enupal\\stripe\\web\\assets\\FontAwesomeAsset") %}