{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = "products" %}
{% set fullPageForm = true %}
{% set title = "Product: "~stripeObject.name %}

{% set testMode = craft.enupalStripe.getMode() %}
{% set stripeUrl = "https://dashboard.stripe.com" %}
{% set stripeUrl = testMode ? stripeUrl~'/test' : stripeUrl %}

{% set crumbs = [
    {    label: "Products"|t('enupal-stripe'), url: url('enupal-stripe/products') }
] %}

{% hook "cp.enupal-stripe.product.edit" %}

{% block actionButton %}
    <a id="share-btn" href="{{ stripeUrl }}/products/{{ stripeObject.id }}" class="btn sharebtn" target="_blank">Edit Product</a>
{% endblock %}

{% block details %}
    {% namespace 'fields' %}

        {% include 'enupal-stripe/products/_productInfo' %}

    {% endnamespace %}
    <hr>
    <div class="meta read-only">
        <div class="data">
            <h5 class="heading">{{ "Date Created"|t('enupal-stripe') }}</h5>
            <div class="value">{{ product.dateCreated|date('short') }} {{ product.dateCreated|time('short') }}</div>
        </div>
        <div class="data">
            <h5 class="heading">{{ "Date Updated"|t('enupal-stripe') }}</h5>
            <div class="value">{{ product.dateUpdated|date('short') }} {{ product.dateUpdated|time('short') }}</div>
        </div>
    </div>
{% endblock %}

{% block content %}


    <div id="modal-product" class="order-edit-modal modal fitted" style="display: none; width: 50%">
            <div id="modal" class="body">
            <header class="header">
                <h2>Stripe Product Object</h2>
            </header>
            <div class="json-object">
                <pre>
                    <code>{{ stripeObject|json_encode(constant('JSON_PRETTY_PRINT')) }}</code>
                </pre>
            </div>
        </div>
        <div class="footer"><div class="buttons right"><button type="button" id="close-modal" class="btn-link-default btn">Close</button></div></div>
    </div>
    {% if not stripeObject.livemode %}
        <span class="testMode">Test Mode</span>
    {% endif %}
    {% set priceLabel = prices|length > 1 ? 'Prices'|t('enupal-stripe') ~ ' (' ~prices|length~')' : 'Price' %}
    {% if prices %}
        {{ forms.field({
            label: priceLabel,
            id: 'prices'
        }) }}
        <div id="variants" class="matrix variant-matrix" style="position: relative;">
            <div class="blocks">
                {% for price in prices %}
                    {% set priceObject = price.getStripeObject() %}
                    <div class="price-matrixblock matrixblock single-col" data-id="{{ price.id }}" tabindex="0">
                        <input class="default-input" type="hidden" name="prices[{{ price.id }}][isDefault]" value="{{ loop.first }}">
                        <div class="titlebar">
                            <div class="preview"></div>
                        </div>
                        <div class="actions">
                            <a id="share-btn" href="{{ stripeUrl ~ '/prices/' ~ priceObject.id }}" class="sharebtn price-edit" target="_blank">Edit Price</a>
                        </div>
                        <div class="fields">
                            <div class="status-properties meta">
                                <div id="prices-{{ price.id }}-status-field" class="field">
                                    <div class="heading">
                                        <label id="prices-{{ price.id }}-status-label" for="prices-{{ price.id }}-status">
                                            Status
                                        </label>
                                    </div>
                                    <div class="input ltr">
                                        {{ price.getStatusHtml|raw }}
                                    </div>
                                </div>
                            </div>

                            <div class="id-properties meta">
                                <div id="prices-{{ price.id }}-id-field" class="field">
                                    <div class="heading">
                                        <label id="prices-{{ price.id }}-id-label" for="prices-{{ price.id }}-id">
                                            Stripe ID
                                        </label>
                                    </div>
                                    <div class="input ltr">
                                        <input readonly autocomplete="off" type="text" id="prices-{{ price.id }}-id" class="code text fullwidth" value="{{ priceObject.id }}" name="prices[{{ price.id }}][id]" dir="ltr">
                                    </div>
                                </div>
                            </div>

                            <div class="price-properties meta">
                                <div id="prices-{{ price.id }}-price-field" class="field">
                                    <div class="heading">
                                        <label id="prices-{{ price.id }}-price-label" for="prices-{{ price.id }}-price">
                                            Price ({{ priceObject.currency|upper }})
                                        </label>
                                    </div>
                                    <div class="input ltr">
                                        <input readonly autocomplete="off" type="text" id="prices-{{ price.id }}-price" class="code text fullwidth" value="{{ craft.enupalStripe.convertFromCents(priceObject.unit_amount, priceObject.currency ) }}" name="prices[{{ price.id }}][price]" dir="ltr">
                                    </div>
                                </div>
                            </div>
                            {% if priceObject.recurring %}
                                <div class="price-properties meta">
                                    <div id="prices-{{ price.id }}-price-field" class="field price-properties-dimensions">
                                        <div class="heading">
                                            <label id="prices-{{ price.id }}-price-label" for="prices-{{ price.id }}-price">
                                                Recurring
                                            </label>
                                        </div>
                                        <div class="input ltr">
                                            {% if priceObject.recurring.aggregate_usage %}
                                                <div class="flex">
                                                    <div class="textwrapper">
                                                        <input readonly autocomplete="off" type="text" id="prices-{{ price.id }}-recurring-usage" class="text fullwidth" value="Aggregate Usage:" name="prices[{{ price.id }}][usage]" autocomplete="off" dir="ltr">
                                                    </div>
                                                    <div class="label light code">{{ priceObject.recurring.aggregate_usage }}</div>
                                                </div>
                                            {% endif %}
                                            <div class="flex">
                                                <div class="textwrapper">
                                                    <input readonly autocomplete="off" type="text" id="prices-{{ price.id }}-recurring-interval" class="text fullwidth" value="Interval:" name="prices[{{ price.id }}][interval]" autocomplete="off" dir="ltr">
                                                </div>
                                                <div class="label light code">{{ priceObject.recurring.interval }}</div>
                                            </div>
                                            <div class="flex">
                                                <div class="textwrapper">
                                                    <input readonly autocomplete="off" type="text" id="prices-{{ price.id }}-recurring-interval" class="text fullwidth" value="Interval Count:" name="prices[{{ price.id }}][interval_count]" autocomplete="off" dir="ltr">
                                                </div>
                                                <div class="label light code">{{ priceObject.recurring.interval_count }}</div>
                                            </div>
                                            <div class="flex">
                                                <div class="textwrapper">
                                                    <input readonly autocomplete="off" type="text" id="prices-{{ price.id }}-recurring-usage-type" class="text fullwidth" value="Usage Type:" name="prices[{{ price.id }}][interval_count]" autocomplete="off" dir="ltr">
                                                </div>
                                                <div class="label light code">{{ priceObject.recurring.usage_type }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}

                        </div>
                    </div>
                {% endfor %}

            </div>
        </div>
    {% endif %}
{% endblock %}

{% css %}


{% endcss %}

{% do view.registerAssetBundle("enupal\\stripe\\web\\assets\\FontAwesomeAsset") %}
{% do view.registerAssetBundle("enupal\\stripe\\web\\assets\\ProductsAsset") %}

{% js %}
    $(document).ready(function() {
    new EnupalStripeProduct();
    });
{% endjs %}